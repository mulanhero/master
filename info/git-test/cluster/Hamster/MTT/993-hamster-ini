[root@gphd-vm211 m]# cat ompi-jimmy-j2.ini 
#======================================================================
# Generic OMPI core performance testing template configuration
#======================================================================
[MTT]
description = [testbake]
trial = 1
min_disk_free = 5000

# Put other values here as relevant to your environment.
hostfile = /root/hostfile
max_np = 8
textwrap =  120 
#drain_timeout = 5
scratch = /usr/local/hamster/mtt-build
logfile =/usr/local/hamster/m/log.file

#======================================================================
# MPI details
#======================================================================
[MPI Details: OMPI]

#exec    = &test_prefix_pretty()/bin/mpirun @hosts@ -np &test_np() @mca@ &test_executable_abspath() &test_argv()
#hosts 	= &if(&have_hostfile(), "--hostfile " . &hostfile(),&if(&have_hostlist(), "--host " . &hostlist(), ""))

exec    = hamster -v -np &test_np() &test_executable_abspath() &test_argv()
#hosts 	= &if(&have_hostfile(), "--hostfile " . &hostfile(),&if(&have_hostlist(), "--host " . &hostlist(), ""))

#======================================================================
# MPI get phase
#======================================================================
[MPI get: OMPI]
mpi_details = OMPI
module = Download
download_url = http://hdsh020.lss.emc.com/hamster/mtt/openmpi-1.7.2.tar.gz
download_version = 1.7.2

#[MPI get: Hamster]
#mpi_details = OMPI
#module = GIT
#git_url = git@git.greenplum.com:~jcao/hamster/jimmy-hamster.git

#======================================================================
# Install MPI phase
#======================================================================
[MPI install: OMPI/GNU-standard]
mpi_get = OMPI
mpi_details = OMPI
save_stdout_on_success = 1
merge_stdout_stderr = 1

module = OMPI
ompi_make_all_arguments = -j 2
ompi_compiler_name = gnu
ompi_compiler_version = &get_gcc_version()
ompi_configure_arguments = <<EOT
--with-devel-headers -disable-heterogeneous 
EOT
ompi_autogen = 0

#======================================================================
# Test get phase
#======================================================================
[Test get: testsuite]
module = Download
download_url = http://hdsh020.lss.emc.com/hamster/mtt/osu-micro-benchmarks-4.2.tar.gz

#======================================================================
# Test build phase
#======================================================================
[Test build: testsuite]
test_get = testsuite
save_stdout_on_success = 1
merge_stdout_stderr = 1
stderr_save_lines = 1000

module = Shell
shell_build_command = <<EOT
make CC=&test_prefix_pretty()/bin/mpicc
EOT

#======================================================================
# Test Run phase
#======================================================================
[Test run]
pass = &and(&cmd_wifexited(), &eq(&cmd_wexitstatus(), 0))
#timeout = 5:00
timeout = &max(60, &multiply(60, &test_np()))
save_stdout_on_pass = 1
merge_stdout_stderr = 1
stdout_save_lines = 100 
stderr_save_lines = 100 

[Test run: testsuite]
include_section = Test run
test_build = testsuite

specify_module = Simple
#simple_pass:tests = osu-micro-benchmarks-4.2/mpi/pt2pt/osu_bw 
#simple_pass:tests = osu_bw osu_latency osu_bibw
simple_pass:tests = &find_executables("mpi/pt2pt")
#np = &env_max_hosts()
np = 2


#======================================================================
# Reporter 
#======================================================================
[Reporter: text file backup]
module = TextFile

textfile_filename = report-$phase-$section-$mpi_name-$mpi_version.txt

# User-defined report headers/footers
textfile_summary_header = <<EOT
hostname: &shell("hostname")
uname: &shell("uname -a")
who am i: &shell("who am i")
EOT

textfile_summary_footer =
textfile_detail_header  = Debug Report
textfile_detail_footer  =
textfile_textwrap = 78

# Send digested summary of mtt execution by email
email_to = jcao@gopivotal.com
email_subject = OMPI test has completed, status: $overall_mtt_status
email_detailed_report = 1
email_footer = <<EOT
Test Scratch Directory is &scratch_root()
EOT